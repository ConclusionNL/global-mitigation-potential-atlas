@model GMPA.Core.Models.ViewModels.PoliciesViewModel
@{
    Layout = "Main.cshtml";
    Model.PageTitle = "National policies";
}

<h1 class="d-flex justify-content-center">@Model.PageTitle</h1>

<div class="row">
    <div class="col-1">
        <div class="container text-center justify-content-center">
            <label for="pilotCountryFilter">Select a country:</label>
            <select name="pilotCountryFilter" id="pilotCountryFilter">
                <option value=""></option>
                <option value="Australia">Australia</option>
                <option value="Brunei">Brunei</option>
                <option value="Cambodia">Cambodia</option>
                <option value="India">India</option>
                <option value="Indonesia">Indonesia</option>
                <option value="Laos">Loa PDR</option>
                <option value="Malaysia">Malaysia</option>
                <option value="Philippines">Philippines</option>
                <option value="Singapore">Singapore</option>
                <option value="Thailand">Thailand</option>
                <option value="Viet Nam">Viet Nam</option>
            </select>
        </div>
        <div class="container text-center mt-3">
            <div class="row">
                <div class="col">
                    <button class="btn btn-primary toggle-container mr-3" id="btnStrategy" data-target="ClimateStrategy">Climate Strategies</button>
                    <button class="btn btn-primary toggle-container" id="btnInventory" data-target="PolicyInventory">Policy Inventory</button>
                </div>
            </div>
        </div>
        <div class="container text-center justify-content-center hidden" id="sectorFilter">
            <label for="filterSector">Filter by Sector:</label>
            <select name="filterSector" id="filterSector" class="sector-dropdown">
                <option value=""></option>
                <option value="Energy">Energy</option>
                <option value="Transport">Transport</option>
                <option value="Industry">Industry</option>
            </select>
        </div>
    </div>

    <div class="col-11">
        <div class="toggle-content" id="ClimateStrategy">
            @{
                <h2>Climate Strategies</h2>
                @foreach (var strategy in Model.ClimateStrategiesBlockList)
                {
                    <div class="card md-3 strategy-item" data-from-country="@strategy.FromCountry">

                        <div class="card-header">
                            <h3>@strategy.PolicyDocumentName</h3>
                        </div>
                        <div class="card-body">
                            <h5>Key Objectives/Targets</h5>
                            @Html.Raw(strategy.KeyObjectivesTargets)
                        </div>

                        <div class="d-flex justify-content-between card-footer">
                            <div class="p-2">
                                <h5>Start Year</h5>
                                @strategy.StartYear
                            </div>
                            <div class="p-2">
                                <h5>Valid till</h5>
                                @strategy.EndYear
                            </div>
                            <div class="ms-auto p-2">
                                <h5>Source</h5>
                                @{
                                    var sourceNumber = 1;
                                }

                                @foreach (var sourceItem in strategy.SourceLink)
                                {
                                    <div>
                                        <a href="@sourceItem">Source @sourceNumber of @strategy.PolicyDocumentName</a>
                                    </div>
                                    sourceNumber++;
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <div class="hidden toggle-content" id="PolicyInventory">
            @{

                <h2>Policy Inventory</h2>
                @foreach (var policy in Model.PolicyInventoryBlockList)
                {
                    <div class="card policy-item" data-from-country="@policy.FromCountry" data-sector="@policy.Sector">
                        <div class="row">
                            <div class="card-header">
                                <h3>@policy.PolicyDocumentName</h3>
                                <div class="d-flex">
                                    <h5>Sector: </h5>
                                    @policy.Sector
                                </div>
                                <div class="d-flex">
                                    <h5>Sub-sector: </h5>
                                    @policy.SubSector
                                </div>
                            </div>
                            <div class="card-body">
                                @Html.Raw(policy.Objectives)
                            </div>
                        </div>
                        <div class="d-flex card-footer justify-content-between">
                            <div class="col-1">
                                <h5>Start Year</h5>
                                @policy.StartDate
                            </div>
                            <div class="col-1">
                                <h5>Valid till</h5>
                                @if (@policy.EndDate == "0")
                                {
                                    <p>Ongoing</p>
                                }
                                else
                                {
                                    @policy.EndDate
                                }
                            </div>
                            <div class="col-1">
                                <h5>Policy Level</h5>
                                @policy.PolicyLevel
                            </div>
                            <div class="col-1">
                                <h5>Policy Origin</h5>
                                @policy.PolicyOrigin
                            </div>
                            <div class="col-1">
                                <h5>Policy Instruments</h5>
                                @policy.PolicyInstruments
                            </div>
                            <div class="col-3">
                                <h5>Source</h5>
                                @{
                                    var sourceNumber = 1;
                                }

                                @foreach (var sourceItem in policy.SourceLink)
                                {
                                    <div>
                                        <a href="@sourceItem">Source @sourceNumber of @policy.PolicyDocumentName</a>
                                    </div>
                                    sourceNumber++;
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>

<script>
    // Selectors for DOM elements
    var toggleButtons = document.querySelectorAll('.toggle-container');
    var strategyItems = document.querySelectorAll('.strategy-item');
    var policyItems = document.querySelectorAll('.policy-item');
    var countryDropdown = document.getElementById('pilotCountryFilter');
    var sectorDropdown = document.getElementById('filterSector');

    // Function to filter policies based on selected country and sector
    function filterPolicies() {
        var selectedCountry = countryDropdown.value;
        var selectedSector = sectorDropdown.value;

        // Filter strategies based on selected country
        strategyItems.forEach(function (item) {
            var country = item.dataset.fromCountry;
            item.classList.toggle('hidden', selectedCountry !== '' && country !== selectedCountry);
        });

        // Filter policies based on selected country and sector
        policyItems.forEach(function (item) {
            var country = item.dataset.fromCountry;
            var sector = item.dataset.sector;
            var itemElement = item.closest('.policy-item');

            if ((selectedCountry === '' || country === selectedCountry) &&
                (selectedSector === '' || sector === selectedSector)) {
                itemElement.classList.remove('hidden');
            } else {
                itemElement.classList.add('hidden');
            }
        });
    }

    // Event listener for country dropdown change
    countryDropdown.addEventListener('change', filterPolicies);

    // Event listener for sector dropdown change
    sectorDropdown.addEventListener('change', filterPolicies);

    // Function to initialize content based on query parameter
    function initializeContent() {
        var paramName = 'country';
        var selectedCountry = getQueryParam(paramName);

        // Set selected country and filter policies
        if (selectedCountry !== null) {
            countryDropdown.value = selectedCountry;
            filterPolicies();
        }
    }

    // Initialize content on page load
    initializeContent();

    // Event listeners for toggle buttons
    toggleButtons.forEach(button => {
        button.addEventListener('click', function () {
            var targetId = this.getAttribute('data-target');
            var targetElement = document.getElementById(targetId);
            var sectorFilterContainer = document.getElementById('sectorFilter');

            // Hide all content containers
            document.querySelectorAll('.toggle-content').forEach(container => {
                container.classList.add('hidden');
            });

            sectorFilterContainer.classList.add('hidden');
            sectorDropdown.value = ''; // Reset sector dropdown when toggling between views

            // Show the selected content container
            targetElement.classList.remove('hidden');

            // Show sector filter container for PolicyInventory view
            if (targetId === 'PolicyInventory') {
                sectorFilterContainer.classList.remove('hidden');
            }
        });
    });

    // Function to get query parameter from URL
    function getQueryParam(name) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }
</script>


<style>
    .divider {
        border-bottom: 1px solid #000000;
        margin-block: 10px;
    }

    h5 {
        margin-right: 5px;
    }

    .hidden {
        display: none;
    }

    .card {
        margin-bottom: 10px
    }
</style>